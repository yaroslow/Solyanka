Using IServiceBus to push events to another app
===

### Description

ServiceBus is an abstraction over bus that combine several bounded context. It helps to transfer data from one app to another. As a bus can be RabbitMQ, Redis and others.

### Install

For using ServiceBus install [Solyanka.ServiceBus with NuGet]() to your project:
By Nuget Package Manager:
    `Install-Package Solyanka.ServiceBus`
By .Net command line interface:
    `dotnet add package Solyanka.ServiceBus`

If you are using Microsoft.DependencyInjection, you may install [Solyanka.ServiceBus.Microsoft.DependencyInjection]() to your project:
By Nuget Package Manager:
    `Install-Package Solyanka.ServiceBus.Microsoft.DependencyInjection`
By .Net command line interface:
    `dotnet add package Solyanka.ServiceBus.Microsoft.DependencyInjection`

There is used bus framework called [MassTransit]()

### IntegrationEvents

'IIntegrationEvent' is an interface of event that will be pushed to bus. To use such event you should inject 'IntegrationEventHandler' as a handler of your event. You may use Reflection or do it manually.
P.S. In [Solyanka.ServiceBus.Microsoft.DependencyInjection] all integration events in asssemblies that you pass injected automatically.

### Inject

```csharp
    ...
    //Other services injecting
    
    services.AddServiceBus(assemblies => {
        //...
        assemblies.Add(typeof(UserCreatedIntegrationEvent).Assembly);
        //...
    }, provider => {
        //here you should configure your bus with MassTransit
    }, consumers => {
        //...
        consumers.SubscribeConsumer<UserCreatedConsumer>();
        //...
    });
    
    ...
```


### RabbitMQ

If you are using Microsoft.DependencyInjection and want to use RabbitMQ as a bus, you may install [Solyanka.ServiceBus.RabbitMq.Microsoft.DependencyInjection]() to your project:
By Nuget Package Manager:
    `Install-Package Solyanka.ServiceBus.RabbitMq.Microsoft.DependencyInjection`
By .Net command line interface:
    `dotnet add package Solyanka.ServiceBus.RabbitMq.Microsoft.DependencyInjection`

```csharp
    ...
    //Other services injecting
    
    services.AddRabbitMqServiceBus(assemblies => 
    {
        //...
        assemblies.Add(typeof(UserCreatedIntegrationEvent).Assembly);
        //...
    }, settings => 
    {
        settings.Host = "messaging",
        settings.VirtualHost = "/",
        settings.Username = "username",
        settings.Password = "password",
        settings.ServiceEndpointName = "endpoint_name",
        // there are other properties:
        // PrefetchCount 8 by default. Maximum number of concurrent messages that are consumed
        // RetryCount 2 by default. Count of retrying
        // RetryInterval 100 by default. Retrying interval in seconds
        // Durable true by default. Messages survive broker restart
    }, consumers => 
    {
        //...
        consumers.SubscribeConsumer<UserCreatedConsumer>();
        //...
    });
    
    ...
```